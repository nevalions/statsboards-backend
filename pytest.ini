[pytest]
asyncio_mode = strict
asyncio_default_fixture_loop_scope = session
log_cli = false
log_cli_level = WARNING
log_file = pytest.log
log_file_level = WARNING
log_level = WARNING
# Performance optimizations
# Removed Alembic migrations - biggest speedup (60-90s saved)
# : stop on first failure (good for development)
# -v: verbose output
# --tb=short: shortened traceback format
# --disable-warnings: faster output
# --no-cov: disable coverage collection for speed
# --asyncio-mode=auto: allow running async tests without decorators in some cases
# -m "not integration": skip integration tests by default (run with -m integration to enable)
# Limit parallel workers to avoid connection pool exhaustion
# Each worker creates a Database instance with connection pool
# With -n auto on systems with many cores, can exceed PostgreSQL max_connections=200
# 8 workers with 8 databases (1 worker per database) provides better isolation
# Skip slow tests by default (websocket, download service with retries)
addopts = -x --tb=short -n 8 --timeout=30 --timeout_method=thread

markers =
    integration: marks tests as integration tests that download from real websites or write to main upload folder (skip by default, run with -m integration)
    slow: marks tests as slow-running tests (skip by default, run with -m slow to include)
    property: marks tests as property-based tests
    random_order_disabled: disable random ordering for this test

filterwarnings =
    ignore::DeprecationWarning:passlib.utils
